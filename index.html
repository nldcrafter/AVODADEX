<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AVODA DEX Wallet Demo</title>
<style>
body { font-family: Arial; background: #f0f2f5; display: flex; justify-content: center; padding-top: 30px; }
.container { background: white; padding: 20px; border-radius: 10px; width: 380px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
h2 { text-align: center; margin-bottom: 20px; }
button { background: #3b82f6; color: white; border: none; padding: 8px 15px; margin: 5px 0; border-radius: 5px; cursor: pointer; width: 100%; }
button:hover { background: #2563eb; }
input { padding: 5px; width: 100%; margin: 5px 0 10px; border-radius: 5px; border: 1px solid #ccc; }
p { margin: 5px 0; word-break: break-all; }
hr { margin: 10px 0; }
</style>
</head>
<body>
<div class="container">
<h2>AVODA DEX Wallet Demo</h2>

<!-- Wallet Section -->
<button onclick="createWallet()">Create Wallet</button>
<button onclick="importWallet()">Import Wallet</button>
<div id="walletSection"></div>
<hr>

<!-- Portfolio -->
<h3>Portfolio</h3>
<div id="portfolioSection">
<p>AVODA: 0</p>
<p>USDT: 0</p>
<p>ETH: 0</p>
</div>
<hr>

<!-- Send / Receive -->
<h3>Send / Receive</h3>
<input id="sendAddress" placeholder="Recipient Address">
<input id="sendAmount" placeholder="Amount">
<button onclick="sendTokens()">Send Tokens</button>
<button onclick="receiveTokens()">Receive Tokens (QR)</button>
<div id="qrSection"></div>
<hr>

<!-- Swap -->
<h3>Swap</h3>
<select id="fromToken">
<option value="AVODA">AVODA</option>
<option value="USDT">USDT</option>
<option value="ETH">ETH</option>
</select>
<select id="toToken">
<option value="USDT">USDT</option>
<option value="AVODA">AVODA</option>
<option value="ETH">ETH</option>
</select>
<input id="swapAmount" placeholder="Amount">
<button onclick="swapTokens()">Swap</button>
<div id="swapSection"></div>
<hr>

<!-- Transaction History -->
<h3>Transactions</h3>
<div id="txHistory"></div>

</div>

<script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
// === Fake Wallet ===
let wallet = null;
let balances = { AVODA: 1000, USDT: 500, ETH: 2 };
let transactions = [];

function createWallet() {
    wallet = { address: '0x' + Math.random().toString(36).substring(2, 15) };
    document.getElementById('walletSection').innerHTML = `<p><strong>Wallet Address:</strong> ${wallet.address}</p>`;
    updatePortfolio();
}

function importWallet() {
    const addr = prompt("Enter wallet address:");
    if (!addr) return;
    wallet = { address: addr };
    document.getElementById('walletSection').innerHTML = `<p><strong>Wallet Address:</strong> ${wallet.address}</p>`;
    updatePortfolio();
}

// === Portfolio ===
function updatePortfolio() {
    document.getElementById('portfolioSection').innerHTML = `
    <p>AVODA: ${balances.AVODA}</p>
    <p>USDT: ${balances.USDT}</p>
    <p>ETH: ${balances.ETH}</p>
    `;
}

// === Send / Receive ===
function sendTokens() {
    const addr = document.getElementById('sendAddress').value;
    const amount = parseFloat(document.getElementById('sendAmount').value);
    const token = 'AVODA'; // default token for demo

    if (!wallet || !addr || !amount || balances[token] < amount) {
        alert('Invalid input or insufficient balance');
        return;
    }

    balances[token] -= amount;
    transactions.push(`Sent ${amount} ${token} to ${addr}`);
    updatePortfolio();
    updateTxHistory();
}

function receiveTokens() {
    if (!wallet) { alert('Create wallet first'); return; }
    const qrDiv = document.getElementById('qrSection');
    qrDiv.innerHTML = '';
    QRCode.toCanvas(wallet.address, { width: 150 }, function(err, canvas) {
        if(err) console.error(err);
        qrDiv.appendChild(canvas);
    });
}

// === Swap ===
function swapTokens() {
    const from = document.getElementById('fromToken').value;
    const to = document.getElementById('toToken').value;
    const amount = parseFloat(document.getElementById('swapAmount').value);

    if (from === to) { alert('Select different tokens'); return; }
    if (balances[from] < amount) { alert('Insufficient balance'); return; }

    const rate = Math.random() * (1.2 - 0.8) + 0.8; // fake exchange rate
    const received = parseFloat((amount * rate).toFixed(2));

    balances[from] -= amount;
    balances[to] += received;

    transactions.push(`Swapped ${amount} ${from} â†’ ${received} ${to}`);
    updatePortfolio();
    updateTxHistory();
    document.getElementById('swapSection').innerText = `You received ${received} ${to} (rate ${rate.toFixed(2)})`;
}

// === Transaction History ===
function updateTxHistory() {
    const div = document.getElementById('txHistory');
    div.innerHTML = '';
    transactions.slice().reverse().forEach(tx => {
        const p = document.createElement('p');
        p.innerText = tx;
        div.appendChild(p);
    });
}
</script>
</body>
</html>
